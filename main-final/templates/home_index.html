<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>LibraFinFact</title>
  <link rel="stylesheet" href="{{url_for('static',filename='home_style.css')}}">
  <link rel="stylesheet" href=https://cdn.jsdelivr.net/sweetalert2/5.3.8/sweetalert2.css>
  <link rel="icon" href="{{url_for('static',filename='favicon.ico')}}">
</head>
<body>
  <div class="app">
    <!-- Sidebar -->
     <div class="sidebar">
        <div class="logo">
            <img src="{{url_for('static',filename='favicon.ico')}}" alt="Logo">
            <span>LibraFinFact</span>
        </div>
        
        <nav>
            <a href="/" class="active"><i class="icon">üè†</i> Home</a>
            <a href="/news_feed"><i class="icon">üì∞</i>News Feed</a>
            <a href="/fake_detection"><i class="icon">üîç</i> Discrepancy Detector</a>
        </nav>
        <div class="auth-buttons">
            <button class="sign-up">Sign Up</button>
            <button class="log-in">Log in</button>
        </div>
    </div>

    <!-- Main Content Wrapper -->
    <!-- Main Content Wrapper -->
    <div class="content-wrapper">
      <!-- Main Content -->
      <main>
        <div class="container">
          <h1 class="gradient-text">Your Finance Queries, Answered with Verified Insights!</h1>
          <input type="hidden" id="clientId" value="{{ client_id }}"></input>
          
          <!-- Search Bar -->
          <div class="search-container glass-card">
            <div class="search-wrapper">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="search-icon">
                <circle cx="11" cy="11" r="8"/>
                <path d="m21 21-4.3-4.3"/>
              </svg>
              <input type="text" placeholder="Ask Anything in Any Language!" id="myInput">
              <button class="mic-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/>
                  <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                  <line x1="12" x2="12" y1="19" y2="22"/>
                </svg>
              </button>
            </div>
            <div class="search-actions">
              
              <button class="action-btn" id="attach-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="m21.44 11.05-9.19 9.19a6 6 0 0 1-8.49-8.49l8.57-8.57A4 4 0 1 1 18 8.84l-8.59 8.57a2 2 0 0 1-2.83-2.83l8.49-8.48"/>
                </svg>
                Attach
              </button>
            </div>
          </div>

          <!-- Quick Access Cards -->
          <div class="cards-grid">
            <div class="quick-access-card glass-card">
              <div class="card-content">
                <div class="icon-wrapper">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                  </svg>
                </div>
                <div class="card-text">
                  <h3>Discover upcoming corporate actions, including share buybacks and dividend announcement.</h3>
                  
                </div>
              </div>
            </div>

            <div class="quick-access-card glass-card">
              <div class="card-content">
                <div class="icon-wrapper">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect width="18" height="18" x="3" y="3" rx="2"/>
                    <path d="M7 7h10"/>
                    <path d="M7 12h10"/>
                    <path d="M7 17h10"/>
                  </svg>
                </div>
                <div class="card-text">
                  <h3>View exchange announcement, including trading update and market disclosures.</h3>
                  
                </div>
              </div>
            </div>

            <div class="quick-access-card glass-card">
              <div class="card-content">
                <div class="icon-wrapper">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect width="18" height="18" x="3" y="3" rx="2"/>
                    <path d="M7 7h10"/>
                    <path d="M7 12h10"/>
                    <path d="M7 17h10"/>
                  </svg>
                </div>
                <div class="card-text">
                  <h3>Stay up-to-date with real-time news feeds and market analysis.</h3>
                  
                </div>
              </div>
            </div>

            <div class="quick-access-card glass-card">
              <div class="card-content">
                <div class="icon-wrapper">
                  <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                  </svg>
                </div>
                <div class="card-text">
                  <h3>Explore the upcoming IPO.</h3>
                  
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>

      <!-- Footer -->
      
    </div>
  </div>
<script src="https://cdn.jsdelivr.net/sweetalert2/5.3.8/sweetalert2.js"></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.min.js'></script>
 <script>
 var input = document.getElementById("myInput");

// Execute a function when the user presses a key on the keyboard
input.addEventListener("keypress", function(event) {
  // If the user presses the "Enter" key on the keyboard
  if (event.key === "Enter") {
    // Cancel the default action, if needed
    console.log("dfd");
    event.preventDefault();
    // Trigger the button element with a click
    swal({
     text:"LibraFinFact is Acquiring Data and Performing Analysis for You",
    title: 'Please Wait...',
    allowEscapeKey: false,
    allowOutsideClick: false,
    onOpen: () => {
      swal.showLoading();
    }
  }).catch(
    () => {}
  );
    window.location.href = "/chat_page?query="+ document.getElementById("myInput").value;
  }
});

const micBtn = document.querySelector('.mic-btn');

// Handle microphone
   // Audio Recording
  let mediaRecorder;
  let audioChunks = [];
  let isRecording = false;

  // Request microphone access
  async function setupMicrophone() {
    try {
      const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
      mediaRecorder = new MediaRecorder(stream);

      mediaRecorder.ondataavailable = (event) => {
        audioChunks.push(event.data);
      };

      mediaRecorder.onstop = () => {
        const audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
        const audioUrl = URL.createObjectURL(audioBlob);
        console.log('Recording stopped, audio URL:', audioUrl);
        
        var form = new FormData();

            form.append("audio_data", audioBlob);
             $.ajax({
                  type: 'POST',
                  url: '/audio_save',
                  data: form,
                  cache: false,
                  processData: false,
                  contentType: false
      
              }).done(function(data) {
              console.log(data);
              input.value = data["transcript"]
        
      });
        // Reset chunks for next recording
        audioChunks = [];
      };

      return true;
    } catch (error) {
      console.error('Error accessing microphone:', error);
      return false;
    }
  }

  // Handle microphone button
  micBtn.addEventListener('click', async () => {
    if (!mediaRecorder) {
      const initialized = await setupMicrophone();
      if (!initialized) {
        alert('Could not access microphone');
        return;
      }
    }

    isRecording = !isRecording;
    micBtn.style.color = isRecording ? '#ef4444' : '#9ca3af';

    if (isRecording) {
      audioChunks = [];
      mediaRecorder.start();
      console.log('Recording started');
    } else {
      mediaRecorder.stop();
      console.log('Recording stopped');
    }
  });

 </script>
</body>
</html>
